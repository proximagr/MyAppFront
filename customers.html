<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Customers</title>
  </head>
  <body>
    <h1>Customers and Projects</h1>
    <label for="customer-select">Select Customer:</label>
    <select id="customer-select"></select>
    <br /><br />
    <table id="project-table">
      <thead>
        <tr>
          <th>Project</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const customerSelect = document.getElementById("customer-select");
      const projectTable = document.getElementById("project-table").getElementsByTagName("tbody")[0];

      // Populate customer select dropdown
      fetch("http://arch.francecentral.cloudapp.azure.com:43704/list-users")
        .then((response) => response.json())
        .then((data) => {
          data.forEach((user) => {
            const option = document.createElement("option");
            option.value = user.id;
            option.text = user.name;
            customerSelect.add(option);
          });
        })
        .catch((error) => console.error(error));

      // Update project table based on selected customer
      customerSelect.addEventListener("change", () => {
        const customerId = customerSelect.value;
        projectTable.innerHTML = "";
        fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-projects?customerId=${customerId}`)
          .then((response) => response.json())
          .then((data) => {
            data.forEach((project) => {
              const row = projectTable.insertRow(-1);
              const projectCell = row.insertCell(0);
              const priceCell = row.insertCell(1);
              projectCell.innerHTML = project.project;
              priceCell.innerHTML = project.price;
            });
          })
          .catch((error) => console.error(error));
      });
    </script>
  </body>
</html>
