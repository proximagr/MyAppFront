<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customers and Projects</title>
</head>
<body>
    <h1>Select a Customer</h1>
    <select id="customerSelect">
        <option value="">Select a Customer</option>
    </select>
    <br>
    <br>
    <h1>Projects</h1>
    <table id="projectsTable">
        <thead>
            <tr>
                <th>Project ID</th>
                <th>Customer ID</th>
                <th>Project Name</th>
                <th>Project Price</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const customerSelect = document.querySelector('#customerSelect');
        const projectsTable = document.querySelector('#projectsTable tbody');

        // Populating the customer dropdown with the data retrieved from /list-users endpoint
        fetch('http://arch.francecentral.cloudapp.azure.com:43704/list-users')
        .then((response) => response.json())
        .then((data) => {
            data.forEach((customer) => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                customerSelect.appendChild(option);
            });
        })
        .catch((error) => console.error(error));

        // Handling the change event on the customer dropdown
        customerSelect.addEventListener('change', (event) => {
            // Clearing the table body
            projectsTable.innerHTML = '';

            // Retrieving the project data for the selected customer from /list-projects endpoint
            const customerId = event.target.value;
            fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-projects?customerId=${customerId}`)
            .then((response) => response.json())
            .then((data) => {
                data.forEach((project) => {
                    const row = projectsTable.insertRow(-1);
                    const idCell = row.insertCell(0);
                    const customerIdCell = row.insertCell(1);
                    const nameCell = row.insertCell(2);
                    const priceCell = row.insertCell(3);
                    idCell.textContent = project.id;
                    customerIdCell.textContent = project.customer_id;
                    nameCell.textContent = project.project;
                    priceCell.textContent = project.price;
                });
            })
            .catch((error) => console.error(error));
        });
    </script>
</body>
</html>
