<!DOCTYPE html>
<html>
<head>
	<title>Customers and Projects</title>
</head>
<body>
	<h1>Customers and Projects</h1>
	<label for="customer-select">Select a Customer:</label>
	<select name="customer" id="customer-select"></select>
	<br><br>
	<h2>Projects:</h2>
	<table id="projects-table">
		<thead>
			<tr>
				<th>ID</th>
				<th>Customer ID</th>
				<th>Project Name</th>
				<th>Price</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>

	<script>
		const customerSelect = document.getElementById("customer-select");
		const projectsTableBody = document.querySelector("#projects-table tbody");

		// Get customers and populate the dropdown menu
		fetch("http://arch.francecentral.cloudapp.azure.com:43704/list-users")
			.then((response) => response.json())
			.then((customers) => {
				customers.forEach((customer) => {
					const option = document.createElement("option");
					option.value = customer.id;
					option.textContent = customer.name;
					customerSelect.appendChild(option);
				});
			})
			.catch((error) => console.error(error));

		// Populate the projects table with projects for the selected customer
		customerSelect.addEventListener("change", () => {
			const customerId = customerSelect.value;

			// Clear the table
			projectsTableBody.innerHTML = "";

			// Get projects for the selected customer
			fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-projects?customerId=${customerId}`)
				.then((response) => response.json())
				.then((projects) => {
					projects.forEach((project) => {
						const row = document.createElement("tr");
						row.innerHTML = `
							<td>${project.id}</td>
							<td>${project.customer_id}</td>
							<td>${project.project_name}</td>
							<td>${project.price}</td>
						`;
						projectsTableBody.appendChild(row);
					});
				})
				.catch((error) => console.error(error));
		});
	</script>
</body>
</html>
