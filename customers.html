<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Customers</title>
  </head>
  <body>
    <h1>Customers</h1>
    <label for="customer-select">Select a customer:</label>
    <select id="customer-select"></select>
    <br /><br />
    <div id="projects-table"></div>

    <script>
      const customerSelect = document.getElementById("customer-select");
      const projectsTable = document.getElementById("projects-table");

      // Retrieve and populate the customer dropdown list
      fetch("http://arch.francecentral.cloudapp.azure.com:43704/list-users")
        .then((response) => response.json())
        .then((data) => {
          data.forEach((customer) => {
            const option = document.createElement("option");
            option.value = customer.id;
            option.text = customer.name;
            customerSelect.add(option);
          });
        })
        .catch((error) => console.error(error));

      // Retrieve and populate the projects table for the selected customer
      customerSelect.addEventListener("change", () => {
        const customerId = customerSelect.value;
        fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-projects?customerId=${customerId}`)
          .then((response) => response.json())
          .then((data) => {
            projectsTable.innerHTML = "";
            if (data.length === 0) {
              projectsTable.innerHTML = "<p>No projects found for this customer.</p>";
              return;
            }
            const table = document.createElement("table");
            const header = table.createTHead().insertRow();
            header.innerHTML = "<th>Project</th><th>Price</th>";
            const tbody = table.createTBody();
            data.forEach((project) => {
              const row = tbody.insertRow();
              const projectCell = row.insertCell();
              const priceCell = row.insertCell();
              projectCell.innerText = project.project;
              priceCell.innerText = project.price;
            });
            projectsTable.appendChild(table);
          })
          .catch((error) => console.error(error));
      });
    </script>
  </body>
</html>
