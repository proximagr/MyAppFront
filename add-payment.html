<!DOCTYPE html>
<html>
<head>
	<title>Add Payment</title>
</head>
<body>
	<h1>Add Payment</h1>
	
	<!-- Select customer from the customers table -->
	<label for="customer">Customer:</label>
	<select id="customer">
		<option value="">Select a customer</option>
	</select>

	<!-- Select project of the selected customer from the projects table -->
	<label for="project">Project:</label>
	<select id="project">
		<option value="">Select a project</option>
	</select>

	<!-- Enter payment details -->
	<label for="payment">Payment amount:</label>
	<input type="number" id="payment">

	<label for="date">Payment date:</label>
	<input type="date" id="date">

	<!-- Add payment button -->
	<button id="addPayment">Add Payment</button>

	<!-- JavaScript code to populate dropdowns and handle adding payment -->
	<script>
		// Populate customers dropdown
		const customersDropdown = document.querySelector('#customer');
		fetch('http://arch.francecentral.cloudapp.azure.com:43704/list-users')
			.then(response => response.json())
			.then(customers => {
				customers.forEach(customer => {
					const option = document.createElement('option');
					option.value = customer.id;
					option.textContent = customer.name;
					customersDropdown.appendChild(option);
				});
			});

		// Populate projects dropdown based on selected customer
		const projectsDropdown = document.querySelector('#project');
		customersDropdown.addEventListener('change', () => {
			const customerId = customersDropdown.value;
			if (customerId) {
				projectsDropdown.innerHTML = '<option value="">Select a project</option>';
				fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-customerprojects?customer_id=${customerId}`)
					.then(response => response.json())
					.then(projects => {
						projects.forEach(project => {
							const option = document.createElement('option');
							option.value = project.id;
							option.textContent = project.project;
							projectsDropdown.appendChild(option);
						});
					});
			} else {
				projectsDropdown.innerHTML = '<option value="">Select a project</option>';
			}
		});

		// Add payment
		const addPaymentButton = document.querySelector('#addPayment');
		addPaymentButton.addEventListener('click', () => {
			const projectId = projectsDropdown.value;
			const payment = document.querySelector('#payment').value;
			const date = document.querySelector('#date').value;

			if (!projectId || !payment || !date) {
				alert('Please select a project and enter payment details');
				return;
			}

			const data = {
				projectId,
				payment,
				date
			};

			fetch('http://arch.francecentral.cloudapp.azure.com:43704/addpayment', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})
				.then(response => response.json())
				.then(payment => {
					alert(`Payment added successfully:\nProject: ${payment.project_name}\nPayment: ${payment.payment}\nDate: ${payment.date}`);
				})
				.catch(error => {
					console.error(error);
					alert('Failed to add payment');
				});
		});
	</script>
</body>
</html>
