<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Add Payment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Add Payment</h1>
    <form>
      <label for="customer">Select Customer:</label>
      <select id="customer" name="customer"></select>
      <br /><br />
      <label for="project">Select Project:</label>
      <select id="project" name="project"></select>
      <br /><br />
      <label for="payment">Payment Amount:</label>
      <input type="text" id="payment" name="payment" />
      <br /><br />
      <label for="date">Payment Date:</label>
      <input type="date" id="date" name="date" />
      <br /><br />
      <button type="button" id="addPayment">Add Payment</button>
    </form>

    <script>
      // Populate the customer dropdown list
      async function populateCustomerDropdown() {
        const response = await fetch('http://arch.francecentral.cloudapp.azure.com:43704/list-users');
        const customers = await response.json();
        const customerDropdown = document.getElementById('customer');
        customerDropdown.innerHTML = '';
        for (let customer of customers) {
          const option = document.createElement('option');
          option.value = customer.id;
          option.text = customer.name;
          customerDropdown.appendChild(option);
        }
        // Populate the project dropdown list when a customer is selected
        customerDropdown.addEventListener('change', populateProjectDropdown);
        customerDropdown.dispatchEvent(new Event('change'));
      }

      // Populate the project dropdown list for the selected customer
      async function populateProjectDropdown() {
        const customerId = document.getElementById('customer').value;
        const response = await fetch(`http://arch.francecentral.cloudapp.azure.com:43704/list-customerprojects?customer_id=${customerId}`);
        const projects = await response.json();
        const projectDropdown = document.getElementById('project');
        projectDropdown.innerHTML = '';
        for (let project of projects) {
          const option = document.createElement('option');
          option.value = project.id;
          option.text = project.project;
          projectDropdown.appendChild(option);
        }
      }

      // Add a payment to the database
      async function addPayment() {
        const projectId = document.getElementById('project').value;
        const paymentAmount = document.getElementById('payment').value;
        const paymentDate = document.getElementById('date').value;
        const response = await fetch('http://arch.francecentral.cloudapp.azure.com:43704/addpayment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            project_id: projectId,
            payment: paymentAmount,
            date: paymentDate
          })
        });
        const data = await response.json();
        alert('Payment added!');
        console.log(data);
        // Clear the dropdown menus and repopulate the customer dropdown
        const customerDropdown = document.getElementById('customer');
        customerDropdown.removeEventListener('change', populateProjectDropdown);
        customerDropdown.value = '';
        const projectDropdown = document.getElementById('project');
        projectDropdown.innerHTML = '';
        populateCustomerDropdown();
      }

      // Call the populateCustomerDropdown function to initialize the page
      populateCustomerDropdown();

      // Attach an event listener to the Add Payment button
      const addPaymentButton = document.getElementById('addPayment');
      addPaymentButton.addEventListener('click', addPayment);
    </script>

<h1>Back home</h1>
<button onclick="navigateToAddProject()">Back to Home</button>
<script>
function navigateToAddProject() {
  window.location.href = 'http://arch.francecentral.cloudapp.azure.com';
}
</script>

  </body>
</html>
